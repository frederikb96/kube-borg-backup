# PVC CSI Snapshot + BorgBackup Helm Chart

This chart provisions two CronJobs that coordinate volume snapshots and
BorgBackup archival jobs using three container images:

1. **kube-pvc-snapshot** – Python utility that creates `VolumeSnapshot`
   resources and prunes old snapshots according to a YAML config mounted as a
   secret.
2. **kube-snapshot-borgbackup** – Python controller that restores the latest
   snapshot into a temporary PVC and starts a pod running the third image.
3. **borgbackup-essentials** – Minimal Alpine image with BorgBackup and OpenSSH
   used to run the actual backup inside the transient pod.

Each CronJob mounts its configuration from a secret generated by the chart. The
Borg pod receives repository credentials and an SSH key via separate secrets.

## Quickstart

```sh
helm repo add snapshot-backup https://frederikb96.github.io/pvc-csi-snapshot-borgbackup-helm
helm repo update
helm show values snapshot-backup/snapshot-borgbackup > my-values.yaml
# Edit my-values.yaml to your needs
helm install snap snapshot-backup/snapshot-borgbackup --values my-values.yaml
```

## Development

To test the rendered Helm templates locally for immich as example use:

```sh
helm template charts/snapshot-borgbackup --values example/values.yaml > /example/rendered.yaml
```
